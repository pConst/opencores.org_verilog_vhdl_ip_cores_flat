<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>ao68000: Operation</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.7.2 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Design&#160;Unit&#160;List</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="navpath">
    <ul>
      <li><a class="el" href="index.html">index</a>      </li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="headertitle">
<h1>Operation </h1>  </div>
</div>
<div class="contents">
<p>The <a class="el" href="classao68000.html" title="ao68000 top level module.">ao68000</a> IP Core is designed to operate in a similar way as the original MC68000. The most import differences are:</p>
<ul>
<li>the core IO ports are compatible with the WISHBONE specification,</li>
<li>the execution of instructions in the <a class="el" href="classao68000.html" title="ao68000 top level module.">ao68000</a> core is not cycle-exact with the original MC68000 and usually takes a few cycles longer.</li>
</ul>
<h3>Setting up the core</h3>
<p>The <a class="el" href="classao68000.html" title="ao68000 top level module.">ao68000</a> IP Core has an WISHBONE MASTER interface. All standard memory access bus cycles conform to the WISHBONE specification. These cycles include:</p>
<ul>
<li>instruction fetch,</li>
<li>data read,</li>
<li>data write.</li>
</ul>
<p>The cycles are either Single, Block or Read-Modify-Write (for the TAS instruction). When waiting to finish a bus cycle the <a class="el" href="classao68000.html" title="ao68000 top level module.">ao68000</a> reacts on the following input signals:</p>
<ul>
<li>ACK_I: the cycle is completed successfully,</li>
<li>RTY_I: the cycle is immediately repeated, the processor does not continue its operation before the current bus cycle is finished. In case of the Read-Modify-Write cycle - only the current bus cycle is repeated: either the read or write.</li>
<li>ERR_I: the cycle is terminated and a bus error is processed. In case of double bus error the processor enters the blocked state.</li>
</ul>
<p>There is also a special bus cycle: the interrupt acknowledge cycle. This cycle is a reaction on receiving a external interrupt from the ipl_i inputs. The processor only samples the ipl_i lines after processing an instruction, so the interrupt lines have to be asserted for some time before the core reacts. The interrupt acknowledge cycle is performed in the following way:</p>
<ul>
<li>ADR_O is set to { 27'b111_1111_1111_1111_1111_1111_1111, 3 bits indicating the interrupt priority level for this cycle },</li>
<li>SEL_O is set to 4'b1111,</li>
<li>fc_o is set to 3'b111 to indicate a CPU Cycle as in the original MC68000.</li>
</ul>
<p>The <a class="el" href="classao68000.html" title="ao68000 top level module.">ao68000</a> reacts on the following signals when waiting to finish a interrupt acknowledge bus cycle:</p>
<ul>
<li>ACK_I: the cycle is completed successfully and the interrupt vector is read from DAT_I[7:0],</li>
<li>RTY_I: the cycle is completed successfully and the processor generates a auto-vector internally,</li>
<li>ERR_I: the cycle is terminated and the processor starts processing a spurious interrupt exception.</li>
</ul>
<p>Every bus cycle is supplemented with output tags:</p>
<ul>
<li>WISHBONE standard tags: SGL_O, BLK_O, RMW_O, CTI_O, BTE_O,</li>
<li><a class="el" href="classao68000.html" title="ao68000 top level module.">ao68000</a> custom tag: fc_o that operates like the Function Code of the original MC68000.</li>
</ul>
<p>The <a class="el" href="classao68000.html" title="ao68000 top level module.">ao68000</a> core has two additional outputs that are used to indicate the state of the processor:</p>
<ul>
<li>reset_o is a external device reset signal. It is asserted when processing the RESET instruction. It is asserted for 124 bus cycles. After that the processor returns to normal instruction processing.</li>
<li>blocked_o is an output that indicates that the processor is blocked after a double bus error. When this output line is asserted the processor is blocked and does not process any instructions. The only way to continue processing instructions is to reset the core.</li>
</ul>
<h3>Resetting the core</h3>
<p>The <a class="el" href="classao68000.html" title="ao68000 top level module.">ao68000</a> core is reset with a asynchronous reset_n input. After deasserting the signal, the core starts its standard startup sequence, which is similar to the one performed by the original MC68000:</p>
<ul>
<li>the value of the SSP register is read from address 0,</li>
<li>the value of the PC is read from address 1.</li>
</ul>
<p>An identical sequence is performed when powering up the core for the first time.</p>
<h3>Processor modes</h3>
<p>The <a class="el" href="classao68000.html" title="ao68000 top level module.">ao68000</a> core has two modes of operation - exactly like the original MC68000:</p>
<ul>
<li>Supervisor mode</li>
<li>User mode.</li>
</ul>
<p>Performing a privileged instruction when running in user mode results in a privilege exception, just like in MC68000.</p>
<h3>Processor states</h3>
<p>The <a class="el" href="classao68000.html" title="ao68000 top level module.">ao68000</a> core can be in one of the following states:</p>
<ul>
<li>instruction processing, which includes group 2 exception processing,</li>
<li>group 0 and group 1 exception processing,</li>
<li>external device reset state when processing the RESET instruction,</li>
<li>blocked state after a double bus error. </li>
</ul>
</div>
<hr class="footer"/><address class="footer"><small>Generated on Sun Jan 16 2011 11:00:03 for ao68000 by&#160;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.2 </small></address>
</body>
</html>
