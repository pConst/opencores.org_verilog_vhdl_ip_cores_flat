<head>
<link rel="stylesheet" href="../../style.css" type="text/css">
</head>
<a href="javascript:history.go(-1)" onMouseOver="self.status=document.referrer;return true">Go Back</a>
<p align='right'><a href='aor3000.tar.gz'>Source code</a></p>
<body>
<div class="main">
 <div class="mid" id="dm">
  <div class="content" id="dmc">
   <h2>
    Details
   </h2>
   <p>
    Name: aor3000
    <br/>
    Created: Aug 11, 2014
    <br/>
    Updated: Aug 12, 2014
    <br/>
    SVN Updated: Aug 12, 2014
    
    
    
    
    
    
   </p>
   <h2>
    Other project properties
   </h2>
   <p>
    Category:
    
     Processor
    
    <br/>
    Language:
    
     Verilog
    
    <br/>
    Development status:
    
     Beta
    
    <br/>
    Additional info:
    <br/>
    WishBone Compliant: No
    <br/>
    License: BSD
   </p>
   <div id="d_Description">
    <h2>
     
     
     Description
    </h2>
    <p id="p_Description">
     The aoR3000 is a MIPS R3000A compatible core capable of booting the Linux kernel version 3.16 in about 3 seconds and with a rating of 48.74 BogoMIPS. It features a compatible MMU, but no FPU.
    </p>
   </div>
   <div id="d_Current status">
    <h2>
     
     
     Current status
    </h2>
    <p id="p_Current status">
     <ul>
      <li>
       11 August 2014 - initial version 1.0.
      </li>
     </ul>
    </p>
   </div>
   <div id="d_Links">
    <h2>
     
     
     Links
    </h2>
    <p id="p_Links">
     <ul>
      <li>
       aoR3000 project on github.com:
       
        http://github.com/alfikpl/aoR3000
       
       .
      </li>
     </ul>
    </p>
   </div>
   <div id="d_Features">
    <h2>
     
     
     Features
    </h2>
    <p id="p_Features">
     The aoR3000 soft processor core has the following features:
     <ul>
      <li>
       5 stage pipeline (single-issue, in-order, forwarding, hazard detection);
      </li>
      <li>
       implements all MIPS I instructions (this includes the privileged coprocessor 0 instructions);
      </li>
      <li>
       the MMU in coprocessor 0 is compatible with the R3000A but has more micro-TLB entries: 64 TLB entries, 8 micro-TLB entries for data, 4 micro-TLB entries for instructions;
      </li>
      <li>
       2 kB instruction cache (direct map);
      </li>
      <li>
       2 kB data cache (direct map);
      </li>
      <li>
       all exceptions are implemented (bus error exceptions are not issued, exceptions in branch delays are supported);
      </li>
      <li>
       the core has one combined instruction/data Altera Avalon MM master interface (with burst and pipelined instruction reads, pipelined data reads);
      </li>
      <li>
       multiplication implemented in hardware using vendor-independent modules (Altera Quartus II infers embedded multipliers);
      </li>
      <li>
       division implemented in hardware using long division (33 clock cycles required);
      </li>
      <li>
       the core uses 7700 LE and runs at 50 MHz on a Altera Cyclone IV EP4CE115F29C7;
      </li>
      <li>
       the core is modeled in a vendor-independent subset of Verilog consistent with the requirements of Verilator (fully synchronous design, no vendor specific module instances);
      </li>
      <li>
       a Verilator generated executable C++ model is available;
      </li>
      <li>
       the core was tested and compared with the vmips software R3000 emulator;
      </li>
      <li>
       the core is chosen to be little-endian and can not be changed by software;
      </li>
     </ul>
    </p>
   </div>
   <div id="d_Resource usage">
    <h2>
     
     
     Resource usage
    </h2>
    <p id="p_Resource usage">
     The following table shows the result of synthesis using a balanced area/speed optimization:
     <code>
      +---------------------------------------------------------------------------------+
      <br/>
      ; Flow Summary                                                                    ;
      <br/>
      +------------------------------------+--------------------------------------------+
      <br/>
      ; Flow Status                        ; Successful - Mon Aug 11 21:46:48 2014      ;
      <br/>
      ; Quartus II 64-Bit Version          ; 14.0.0 Build 200 06/17/2014 SJ Web Edition ;
      <br/>
      ; Revision Name                      ; aoR3000                                    ;
      <br/>
      ; Top-level Entity Name              ; aoR3000                                    ;
      <br/>
      ; Family                             ; Cyclone IV E                               ;
      <br/>
      ; Device                             ; EP4CE115F29C7                              ;
      <br/>
      ; Timing Models                      ; Final                                      ;
      <br/>
      ; Total logic elements               ; 7,660 / 114,480 ( 7 % )                    ;
      <br/>
      ;     Total combinational functions  ; 7,174 / 114,480 ( 6 % )                    ;
      <br/>
      ;     Dedicated logic registers      ; 2,633 / 114,480 ( 2 % )                    ;
      <br/>
      ; Total registers                    ; 2633                                       ;
      <br/>
      ; Total pins                         ; 115 / 529 ( 22 % )                         ;
      <br/>
      ; Total virtual pins                 ; 0                                          ;
      <br/>
      ; Total memory bits                  ; 61,616 / 3,981,312 ( 2 % )                 ;
      <br/>
      ; Embedded Multiplier 9-bit elements ; 8 / 532 ( 2 % )                            ;
      <br/>
      ; Total PLLs                         ; 0 / 4 ( 0 % )                              ;
      <br/>
      +------------------------------------+--------------------------------------------+
      <br/>
      +-------------------------------------------------+
      <br/>
      ; Slow 1200mV 85C Model Fmax Summary              ;
      <br/>
      +-----------+-----------------+------------+------+
      <br/>
      ; Fmax      ; Restricted Fmax ; Clock Name ; Note ;
      <br/>
      +-----------+-----------------+------------+------+
      <br/>
      ; 52.58 MHz ; 52.58 MHz       ; clk        ;      ;
      <br/>
      +-----------+-----------------+------------+------+
      <br/>
     </code>
    </p>
   </div>
   <div id="d_Implemented instructions">
    <h2>
     
     
     Implemented instructions
    </h2>
    <p id="p_Implemented instructions">
     All the MIPS I instructions are implemented:
     <ul>
      <li>
       ADD, ADDI, ADDIU, ADDU, AND, ANDI, NOR, OR, ORI, SLL, SLLV, SLT, SLTI, SLTIU, SLTU, SRA, SRAV, SRL, SRLV, SUB, SUBU, XOR, XORI, LUI;
      </li>
      <li>
       DIV, DIVU, MULT, MULTU, MTHI, MTLO, MFHI, MFLO;
      </li>
      <li>
       BREAK, SYSCALL;
      </li>
      <li>
       CFCz, CTCz, LWCz, SWCz;
      </li>
      <li>
       MFCz, MTCz;
      </li>
      <li>
       COPz, RFE, TLBP, TLBR, TLBWI, TLBWR;
      </li>
      <li>
       BEQ, BGEZ, BGEZAL, BGTZ, BLEZ, BLTZ, BLTZAL, BNE, J, JAL, JALR, JR;
      </li>
      <li>
       LB, LBU, LH, LHU, LW, LWL, LWR, SB, SH, SW, SWL, SWR;
      </li>
     </ul>
    </p>
   </div>
   <div id="d_Running the tests">
    <h2>
     
     
     Running the tests
    </h2>
    <p id="p_Running the tests">
     The aoR3000 core can be converted by Verilator to a C++ executable model. This executable model was compared with the vmips software R3000 emulator (http://vmips.sourceforge.net/) in simulation.
All instructions were simulated with random register and memory contents. After every instruction the register contents are compared.

To run the test the following steps have to be taken:
     <ul>
      <li>
       compile the vmips emulator in sim/vmips/ by 'make tester';
      </li>
      <li>
       compile the Verilator aoR3000 model in sim/aoR3000/ by 'make tester';
      </li>
      <li>
       choose the test to be run in sim/tester/main_tester.cpp by setting the pointer 'tst_t *tst_current =';
      </li>
      <li>
       compile the tester in sim/tester/ by 'make tester';
      </li>
      <li>
       run the tester in sim/tester/ by './main_tester';
      </li>
     </ul>
    </p>
   </div>
   <div id="d_GNU toolchain">
    <h2>
     
     
     GNU toolchain
    </h2>
    <p id="p_GNU toolchain">
     To run programs on the aoR3000 a standard GNU toolchain in required. I used the following options during compilation of the toolchain:
     <ul>
      <li>
       for GNU binutils:
       <code>
        './../binutils-2.24.51/configure --prefix= --target=mipsel-unknown-linux-gnu'
       </code>
       ;
      </li>
      <li>
       for GCC:
       <code>
        './../gcc-4.9.1/configure --prefix= --target=mipsel-unknown-linux-gnu --enable-languages=c --disable-threads --disable-shared --disable-libssp --disable-libquadmath --disable-libgomp --disable-libatomic'
       </code>
       ;
      </li>
     </ul>
     The target 'mipsel-unknown-elf' can also be used, but more changes are required to the Linux kernel in that case.
    </p>
   </div>
   <div id="d_Building a minimal Linux kernel">
    <h2>
     
     
     Building a minimal Linux kernel
    </h2>
    <p id="p_Building a minimal Linux kernel">
     In the directory linux/ there is a minimal set of files required to add the aoR3000 SoC platform to the kernel sources version 3.16. To compile the kernel with these changes just copy/overwrite the files in
a Linux source tree. After that
     <code>
      'make ARCH=mips CROSS_COMPILE=mipsel-unknown-linux-gnu- vmlinux.bin'
     </code>
     to build the kernel.
    </p>
   </div>
   <div id="d_Booting the Linux kernel in simulation on a Verilator executable model of the aoR3000">
    <h2>
     
     
     Booting the Linux kernel in simulation on a Verilator executable model of the aoR3000
    </h2>
    <p id="p_Booting the Linux kernel in simulation on a Verilator executable model of the aoR3000">
     The booting of the Linux kernel is performed in a similar method like the tests described above. The Verilator executable model of the aoR3000 is run together with the vmips R3000 software simulator to verify
the correctness of the aoR3000. Every write to memory is checked to confirm that both of the models write the same data at the same time and in the same order.

To boot the Linux kernel in simulation the following steps have to be taken:
     <ul>
      <li>
       compile the vmips emulator in sim/vmips/ by 'make linux';
      </li>
      <li>
       compile the Verilator aoR3000 model in sim/aoR3000/ by 'make linux';
      </li>
      <li>
       compile the tester in sim/tester/ by 'make linux';
      </li>
      <li>
       compile the Linux kernel to get the 'vmlinux.bin' file in the arch/mips/boot/ directory;
      </li>
      <li>
       run the tester in sim/tester/ by './main_linux ';
      </li>
     </ul>
     The booting of the Linux kernel takes about 12 minutes on a modern PC (more than 46 milion instructions have to be executed/simulated).

The tester simulates the following hardware devices:
     <ul>
      <li>
       an eary Linux console that outputs the data written to that console to the file 'tester/early_console.txt';
      </li>
      <li>
       a simple hardware time interrupt device that signals IRQ 0 every 10 miliseconds;
      </li>
      <li>
       an Altera JTAG UART connected to a pseudo terminal (Unix PTY). The terminal name is printed just after executing the tester (for example: 'slave pty: /dev/pts/9');
      </li>
     </ul>
     To connect to this terminal one can use the following command: 'picocom --nolock /dev/pts/9'. Data can be read and written to this terminal.
    </p>
   </div>
   <div id="d_Booting the Linux kernel on a FPGA with a synthesized aoR3000">
    <h2>
     
     
     Booting the Linux kernel on a FPGA with a synthesized aoR3000
    </h2>
    <p id="p_Booting the Linux kernel on a FPGA with a synthesized aoR3000">
     Together with the aoR3000 core there is also a example SoC in the syn/soc/ directory. It consists of:
     <ul>
      <li>
       the aoR3000 core;
      </li>
      <li>
       an Altera JTAG UART;
      </li>
      <li>
       an Altera SDRAM controller;
      </li>
      <li>
       a simple time interrupt device;
      </li>
      <li>
       onchip memory for the boot code of the aoR3000;
      </li>
      <li>
       an Altera JTAG to Avalon Master Bridge to upload the Linux kernel;
      </li>
     </ul>
     The SoC is designed for the Terasic DE2-115 board.

To compile the SoC the following steps have to be taken:
     <ul>
      <li>
       open the Altera Quartus II project in syn/soc/;
      </li>
      <li>
       open the Qsys tool and generate the HDL;
      </li>
      <li>
       compile the project;
      </li>
      <li>
       program the FPGA with the compiled project;
      </li>
      <li>
       in the Altera Nios2 Command Shell enter the directory arch/mips/boot/ of the Linux kernel and run 'system-console -cli';
      </li>
      <li>
       load the Linux kernel binary using the system-console by entering the following TCL commands at the system-console prompt:
      </li>
     </ul>
     <hr/>
     <code>
      set srv [claim_service "master" [lindex [get_service_paths "master"] 0] ""];
      <br/>
      master_write_from_file $srv vmlinux.bin 0;
      <br/>
      close_service master $srv;
      <br/>
     </code>
     <hr/>
     <ul>
      <li>
       open the nios2-terminal in a Altera Nios2 Command Shell;
      </li>
      <li>
       verify that the following text is displayed in the terminal: 'Press any key to boot kernel...';
      </li>
      <li>
       press any key to boot the kernel;
      </li>
     </ul>
     The kernel is booted with the following output displayed on the nios2-terminal:
     <hr/>
     <code>
      Press any key to boot kernel...
      <br/>
      Booting kernel...
      <br/>
      console [ttyJ0] enabled
      <br/>
      bootconsole [early0] disabled
      <br/>
      Freeing unused kernel memory: 176K (80204000 - 80230000)
      <br/>
      #
     </code>
     <hr/>
     A shell is run as init in the early root-fs. The early root-fs is the compiled klibc project.

After running the command dmesg the following output is displayed:
     <hr/>
     <code>
      Linux version 3.16.0 (alek@duke) (gcc version 4.9.1 (GCC) ) #4 Mon Aug 11 23:49:07 CEST 2014
      <br/>
      bootconsole [early0] enabled
      <br/>
      CPU0 revision is: 00000230 (R3000A)
      <br/>
      Determined physical RAM map:
      <br/>
      memory: 08000000 @ 00000000 (usable)
      <br/>
      Initrd not found or empty - disabling initrd
      <br/>
      Zone ranges:
      <br/>
      Normal   [mem 0x00000000-0x07ffffff]
      <br/>
      Movable zone start for each node
      <br/>
      Early memory node ranges
      <br/>
      node   0: [mem 0x00000000-0x07ffffff]
      <br/>
      On node 0 totalpages: 32768
      <br/>
      free_area_init_node: node 0, pgdat 80203600, node_mem_map 81000000
      <br/>
      Normal zone: 256 pages used for memmap
      <br/>
      Normal zone: 0 pages reserved
      <br/>
      Normal zone: 32768 pages, LIFO batch:7
      <br/>
      Primary instruction cache 2kB, linesize 4 bytes.
      <br/>
      Primary data cache 2kB, linesize 4 bytes.
      <br/>
      pcpu-alloc: s0 r0 d32768 u32768 alloc=1*32768
      <br/>
      pcpu-alloc: [0] 0
      <br/>
      Built 1 zonelists in Zone order, mobility grouping on.  Total pages: 32512
      <br/>
      Kernel command line:  console=ttyJ0,115200
      <br/>
      PID hash table entries: 512 (order: -1, 2048 bytes)
      <br/>
      Dentry cache hash table entries: 16384 (order: 4, 65536 bytes)
      <br/>
      Inode-cache hash table entries: 8192 (order: 3, 32768 bytes)
      <br/>
      Memory: 127492K/131072K available (1741K kernel code, 101K rwdata, 212K rodata, 176K init, 171K bss, 3580K reserved)
      <br/>
      SLUB: HWalign=32, Order=0-3, MinObjects=0, CPUs=1, Nodes=1
      <br/>
      NR_IRQS:128
      <br/>
      Console: colour dummy device 80x25
      <br/>
      Calibrating delay loop... 48.74 BogoMIPS (lpj=243712)
      <br/>
      pid_max: default: 32768 minimum: 301
      <br/>
      Mount-cache hash table entries: 1024 (order: 0, 4096 bytes)
      <br/>
      Mountpoint-cache hash table entries: 1024 (order: 0, 4096 bytes)
      <br/>
      futex hash table entries: 256 (order: -1, 3072 bytes)
      <br/>
      io scheduler noop registered
      <br/>
      io scheduler deadline registered
      <br/>
      io scheduler cfq registered (default)
      <br/>
      ttyJ0 at MMIO 0x1ffffff0 (irq = 3, base_baud = 0) is a Altera JTAG UART
      <br/>
      console [ttyJ0] enabled
      <br/>
      bootconsole [early0] disabled
      <br/>
      Freeing unused kernel memory: 176K (80204000 - 80230000)
      <br/>
     </code>
     <hr/>
    </p>
   </div>
   <div id="d_License">
    <h2>
     
     
     License
    </h2>
    <p id="p_License">
     Most of the files in this project are under the BSD license. All the Verilog code for the aoR3000 core is under the BSD license.

A few files are under the GPL license. These files are:
     <ul>
      <li>
       all files in the sim/vmips/ directory;
      </li>
      <li>
       all files in the linux/ directory;
      </li>
     </ul>
     See the LICENSE file for details.
    </p>
   </div>
  </div>
  <div style="clear:both;margin-left:200px;">
  </div>
 </div>
</div>
</body>
<p id='foot'>Database updated on 12 June 2015</p>
